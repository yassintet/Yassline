# Configuracion para Next.js en Hostinger
# Version optimizada para manejar archivos HTML y directorios

# Headers de seguridad (equivalentes a next.config, aplicados en servidor)
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "DENY"
  Header set X-XSS-Protection "1; mode=block"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Forzar HTTPS
  RewriteCond %{HTTPS} off
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  
  # CRITICO: Permitir acceso directo a archivos en _next/ (sin rewrite)
  RewriteCond %{REQUEST_URI} ^/_next/
  RewriteRule ^(.*)$ - [L]

  # RESERVAS: /reservas/ID-real -> servir placeholder (solo existe placeholder.html en el build).
  RewriteCond %{REQUEST_URI} ^/reservas/[^/]+/?$
  RewriteCond %{REQUEST_URI} !^/reservas/placeholder/?$
  RewriteRule ^reservas/([^/]+)/?$ /reservas/placeholder.html [L]

  # PAGO: /pago/ID-real -> servir placeholder (solo existe ese HTML en el build).
  RewriteCond %{REQUEST_URI} ^/pago/[^/]+/?$
  RewriteCond %{REQUEST_URI} !^/pago/placeholder/?$
  RewriteRule ^pago/([^/]+)/?$ /pago/placeholder.html [L]

  RewriteCond %{REQUEST_URI} ^/pago/[^/]+/(binance|moneygram|redotpay|transferencia)/?$
  RewriteCond %{REQUEST_URI} !^/pago/placeholder/
  RewriteRule ^pago/([^/]+)/(binance|moneygram|redotpay|transferencia)/?$ /pago/placeholder/$2.html [L]

  # Permitir acceso a archivos que existen fisicamente
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^(.*)$ - [L]

  # NO tocar archivos estaticos por extension
  RewriteCond %{REQUEST_URI} \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|json|map|webp|mp4|webm|html)$ [NC]
  RewriteRule ^(.*)$ - [L]

  # IMPORTANTE: Si la URL termina en /, intentar servir el archivo HTML correspondiente
  RewriteCond %{REQUEST_URI} ^(.+)/$
  RewriteCond %{DOCUMENT_ROOT}%1.html -f
  RewriteRule ^(.+)/$ /$1.html [L]

  # IMPORTANTE: Si la URL NO termina en / pero existe un archivo HTML, servirlo
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI}.html -f
  RewriteRule ^(.*)$ /$1.html [L]

  # Permitir acceso a directorios que existen fisicamente
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^(.*)$ - [L]

  # Redirigir todo lo demas a index.html (SPA routing)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ /index.html [L]
</IfModule>

# Compresion GZIP
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Cache
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>
